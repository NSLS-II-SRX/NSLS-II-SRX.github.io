<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Deploying metadatastore &mdash; NSLS-II CSX Beamline Docs 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="NSLS-II CSX Beamline Docs 0.1 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">
  
  <a href="https://github.com/NSLS-II-CSX/csxtools"
     class="visible-desktop hidden-xs"><img
    id="gh-banner"
    style="position: absolute; top: 50px; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
    alt="Fork me on GitHub"></a>
  <script>
    // Adjust banner height.
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
  </script>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          NSLS-II CSX Beamline Docs</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../srx/index.html">SRX (5-ID-1) Beamline Documentation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Deploying metadatastore</a><ul>
<li><a class="reference internal" href="#lessons-learned-from-srx-and-csx">Lessons learned from SRX and CSX</a></li>
<li><a class="reference internal" href="#proposed-deployment-strategy">Proposed Deployment Strategy</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Deploying metadatastore</a><ul>
<li><a class="reference internal" href="#lessons-learned-from-srx-and-csx">Lessons learned from SRX and CSX</a></li>
<li><a class="reference internal" href="#proposed-deployment-strategy">Proposed Deployment Strategy</a></li>
</ul>
</li>
</ul>

<div id="sourcelink">
  <a href="../_sources/deploying/metadatastore.txt"
     rel="nofollow">Source</a>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="deploying-metadatastore">
<h1>Deploying metadatastore<a class="headerlink" href="#deploying-metadatastore" title="Permalink to this headline">¶</a></h1>
<div class="section" id="lessons-learned-from-srx-and-csx">
<h2>Lessons learned from SRX and CSX<a class="headerlink" href="#lessons-learned-from-srx-and-csx" title="Permalink to this headline">¶</a></h2>
<p>Beamlines will have /DATA and /POOL data storage. /DATA seems to be for
experimental data and /POOL for analysis.  SRX and CSX have opted to run the
mongo database daemon on the channel archiver server (xf05id-ca1, xf23id-ca).
This seems to be a reasonable setup and will be repeated on other beamlines
until someone provides a better option.  We found it useful to set up an alias
as CSX called &#8216;xf23id-broker&#8217; that metadatastore and filestore could point to
so that they dont actually care which machine the mongodb daemon is running on.
We should do the same for SRX and all future beamlines, unless a better option
is presented.  Contact Petkus to do this.</p>
</div>
<div class="section" id="proposed-deployment-strategy">
<h2>Proposed Deployment Strategy<a class="headerlink" href="#proposed-deployment-strategy" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Set up an alias at beamline for the server running the mongo daemon
(xf##id-broker)</p>
</li>
<li><p class="first">Install and configuration of mongodb on xf##id-broker</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Install mongodb on xf##id-broker:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo apt-get install mongodb
</pre></div>
</div>
</li>
<li><p class="first">Edit /etc/mongodb.conf so that <code class="docutils literal"><span class="pre">dbpath=/DATA/mongodb/</span></code> and
<code class="docutils literal"><span class="pre">bind_ip</span> <span class="pre">=</span> <span class="pre">0.0.0.0</span></code></p>
</li>
<li><p class="first">Make the directory <code class="docutils literal"><span class="pre">/DATA/mongodb/</span></code></p>
</li>
<li><p class="first">Edit the permissions of <code class="docutils literal"><span class="pre">/DATA/mongodb/</span></code> so that the mongo daemon can write
to this location: <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">mongodb:mongodb</span> <span class="pre">/DATA/mongodb</span></code></p>
</li>
<li><p class="first">Restart the monogo daemon: <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">mongodb</span> <span class="pre">restart</span></code></p>
</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Install metadatstore on a beamline computer. Note: This section of the guide
assumes you have already installed anaconda or miniconda and set them up to
talk to the NSLS-II binstar</p>
<blockquote>
<div><ol class="arabic simple">
<li>Activate whatever environment was set up: <code class="docutils literal"><span class="pre">source</span> <span class="pre">activate</span> <span class="pre">&lt;env_name&gt;</span></code></li>
<li>Install metadatastore: <code class="docutils literal"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">metadatastore</span> <span class="pre">-y</span></code></li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Testing metadatastore installation</p>
<blockquote>
<div><ol class="arabic simple">
<li><strong>Option 1.</strong> Use <code class="docutils literal"><span class="pre">ophyd</span></code> to perform a scan and <code class="docutils literal"><span class="pre">databroker</span></code> to
retrieve the scan data.</li>
<li><strong>Option 2.</strong> Insert synthetic data into metadatastore (change the
database name!!) and retrieve it with databroker.</li>
</ol>
</div></blockquote>
</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/deploying/metadatastore.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2015, Brookhaven Science Associates, Brookhaven National Lab..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>